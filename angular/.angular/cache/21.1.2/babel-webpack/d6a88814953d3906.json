{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/bagia/Desktop/S1/notes cours/Web/VersionMax/Web-Sampler-cours-2/Web-Sampler-deploiment/angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { environment } from '../environments/environment';\n// Ajoute des fichiers audio à une liste existante, jusqu'à une limite max\nexport function appendAudioFiles(existing, added, max = 16) {\n  const combined = [...existing, ...added];\n  if (combined.length > max) {\n    return {\n      files: combined.slice(0, max),\n      truncated: true\n    };\n  }\n  return {\n    files: combined,\n    truncated: false\n  };\n}\n// Construit des PresetSample à partir d'une liste d'URLs\nexport function buildSamplesFromUrls(urls) {\n  return urls.map(u => {\n    const trimmed = u.trim();\n    const baseName = trimmed.split(/[\\\\/]/).pop() || 'sample';\n    return {\n      name: baseName,\n      url: trimmed\n    };\n  });\n}\n// Construit des PresetSample à partir de la réponse d'upload\nexport function buildSamplesFromUpload(folderName, upload) {\n  return (upload.files || []).map(f => {\n    const baseName = (f.originalName || '').split(/[\\\\/]/).pop() || f.storedName || 'sample';\n    return {\n      name: baseName,\n      url: `./${folderName}/${f.storedName}`\n    };\n  });\n}\n// Vérifie si une URL pointe vers un fichier audio valide\nexport function isValidAudioUrl(_x) {\n  return _isValidAudioUrl.apply(this, arguments);\n}\n// Vérifie chaque URL dans les samples et retourne la première invalide ou null si toutes sont valides\nfunction _isValidAudioUrl() {\n  _isValidAudioUrl = _asyncToGenerator(function* (rawUrl) {\n    let url = (rawUrl || '').trim();\n    if (!url) return false;\n    // Si l'URL n'est pas absolue, on la complète avec la base de l'API\n    if (!/^https?:\\/\\//i.test(url)) {\n      const cleaned = url.replace(/^\\.?\\//, '');\n      url = `${environment.apiBase}/presets/${cleaned}`;\n    }\n    // On fait une requête HEAD pour vérifier le type de contenu\n    //si ce n'est pas ok ou pas audio on retourne false\n    try {\n      const res = yield fetch(url, {\n        method: 'HEAD'\n      });\n      if (!res.ok) return false;\n      const ct = (res.headers.get('content-type') || '').toLowerCase();\n      return ct.startsWith('audio/') || ct.includes('octet-stream');\n    } catch {\n      return false;\n    }\n  });\n  return _isValidAudioUrl.apply(this, arguments);\n}\nexport function validateUrlSamples(_x2) {\n  return _validateUrlSamples.apply(this, arguments);\n}\nfunction _validateUrlSamples() {\n  _validateUrlSamples = _asyncToGenerator(function* (samples) {\n    for (const s of samples) {\n      const ok = yield isValidAudioUrl(s.url);\n      if (!ok) return s.url;\n    }\n    return null;\n  });\n  return _validateUrlSamples.apply(this, arguments);\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}